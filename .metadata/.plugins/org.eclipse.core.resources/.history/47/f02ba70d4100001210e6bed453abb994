package com.deveryware.locsight.client;

import com.google.gwt.core.client.EntryPoint;
import com.google.gwt.user.client.Window;
import com.google.gwt.user.client.ui.HTML;
import com.google.gwt.user.client.ui.RootPanel;
import com.google.gwt.user.client.ui.TabPanel;

/**
 * Entry point classes define <code>onModuleLoad()</code>.
 */
public class Locsight implements EntryPoint {

	@Override
	public void onModuleLoad() {
		
		 // Create a tab panel with three tabs, each of which displays a different
	    // piece of text.
	    TabPanel tp = new TabPanel();
	    tp.add(new HTML("Foo"), "foo");
	    tp.add(new HTML("Bar"), "bar");
	    tp.add(new HTML("Baz"), "baz");

	    // Show the 'bar' tab initially.
	    tp.selectTab(1);

	    // Add it to the root panel.
	    RootPanel.get().add(tp);
	}

	public static native void checkForNewAlerts() /*-{
	  	var nbAlertsFromMessage  = parseInt(window.opener.document.getElementById("nbAlertsId").value, 10);
		var allAlertsFromMessage  = window.opener.document.getElementById("allAlertsId");
		var clickedBoitierName = window.opener.document.getElementById("clickedBoitierName").value;
		var nbAlerts  = parseInt($("#nbAlertsId").val(), 10);
		var boitierEnAlerteAouvrir = null;
		var pasDeNouvelleAlerteCliquee = "pasDeNouvelleAlerteCliquee";

		if (nbAlerts < nbAlertsFromMessage) {
			for (var i = nbAlerts + 1; i <= nbAlertsFromMessage; i++) {
				start = '#start#' + i + '#';
				indexStart = allAlertsFromMessage.value.indexOf(start, 0);
				$("#indexStartId").val(indexStart);
				
				end = '#end#' + i + '#';
				indexEnd = allAlertsFromMessage.value.indexOf(end, 0);
				$("#indexEndId").val(indexEnd);
				
				var nouvelleAlerte = allAlertsFromMessage.value.substring(indexStart + start.length, indexEnd);
				$("#nouvelleAlerteId").val(nouvelleAlerte);
				
				var id_boitier = parseInt(getBoitierId(nouvelleAlerte), 10);
				$("#boitierId").val(id_boitier);

				var id_alerteType = parseInt(getAlerteTypeId(nouvelleAlerte), 10);
				$("#typeAlerteId").val(id_alerteType);

				var id_severite = parseInt(getSeveriteId(nouvelleAlerte), 10);
				$("#severiteId").val(id_severite);
				
				createAlert(id_boitier, id_alerteType, id_severite);
				}
			$("#nbAlertsId").val(nbAlertsFromMessage);
		} else {
			$("#msgId").val(nbAlerts + ' >=' + nbAlertsFromMessage);
		}
		// alert('clickedBoitierName=' +clickedBoitierName);
		if (clickedBoitierName !="" && clickedBoitierName != pasDeNouvelleAlerteCliquee) {
			boitierEnAlerteAouvrir = getBoitierEnAlerteWhereNameIs(clickedBoitierName);
			ouvrirNouvelOnglet(boitierEnAlerteAouvrir, "visu");
			window.opener.document.getElementById("clickedBoitierName").value = pasDeNouvelleAlerteCliquee; 
			
			// ce if sert a ce que l'onglet ne reprenne pas le focus toutes les sec dans le cas ou il a deja et ouvert.
			//if (!ongletDejaCree(boitierEnAlerteAouvrir)) {
			//	ouvrirNouvelOnglet(boitierEnAlerteAouvrir, "visu");
			//}
		}
		
		setTimeout("checkForNewAlerts()", 1 * 1000);
	}-*/;
	
}